<div class="grid-container">
  <div class="grid-header">
    <h2>Corporate Actions</h2>
    <div class="grid-actions">
      <button (click)="exportToCsv()" class="btn">Export CSV</button>
      <button (click)="openColumnVisibilityMenu()" class="btn">
        Manage Columns
      </button>
      <button mat-stroked-button (click)="toggleFilters()">
        <fa-icon [icon]="faFilter"></fa-icon>
        Filters
      </button>
      <!-- <button (click)="clearSelection()" class="btn">Clear Selection</button> -->
      <input
        (input)="onFilterTextBoxChanged($event)"
        type="text"
        placeholder="Search..."
        class="search-input"
      />
      <button (click)="resetFilters()" class="btn">Reset</button>
    </div>
  </div>

   <!-- <div class="filters-section" *ngIf="showFilters">
    <div class="filters-header">
      <fa-icon [icon]="faFilter"></fa-icon>
      <h3>Filters</h3>
    </div>
    <p class="filter-hint">Add conditions to filter the data</p>

    <div
      class="filter-row"
      *ngFor="let condition of filterConditions; let i = index"
    >
      <mat-form-field>
        <mat-label>Group</mat-label>
        <mat-select
          [(ngModel)]="condition.group"
          (ngModelChange)="applyFilters()"
        >
          @for (item of groupFilter; track $index) {
          <mat-option value="{{ item.value }}">{{ item.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Field</mat-label>
        <mat-select
          [(ngModel)]="condition.field"
          (ngModelChange)="applyFilters()"
        >
          @for (item of fieldFilter; track $index) {
          <mat-option value="{{ item.value }}">{{ item.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Operator</mat-label>
        <mat-select
          [(ngModel)]="condition.operator"
          (ngModelChange)="applyFilters()"
        >
          @for (item of operatorFilter; track $index) {
          <mat-option value="{{ item.value }}">{{ item.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Value</mat-label>
        <input
          matInput
          [(ngModel)]="condition.value"
          (ngModelChange)="applyFilters()"
        />
      </mat-form-field>

      <button mat-icon-button color="warn" (click)="removeFilter(i)">
        <fa-icon [icon]="faTrash"></fa-icon>
      </button>
    </div>
    </div> -->

  <!-- Column Visibility Menu -->
  <div *ngIf="showColumnMenu" class="column-menu">
    <div class="column-menu-header">
      <h3>Manage Columns</h3>
      <button (click)="showColumnMenu = false" class="close-btn">
        &times;
      </button>
    </div>
    <div class="column-menu-content">
      <!-- <div *ngFor="let col of columnDefs" class="column-option">
            <label>
              <input 
                type="checkbox" 
                [checked]="!col.hide" 
                (change)="toggleColumn(col)"
              />
              {{ col.headerName }}
            </label>
          </div> -->
      <div *ngFor="let column of columnGroups">
        <div class="group-header" (click)="toggleGroup(column)">
          <span>{{ column.label }}</span>
          <mat-icon>{{
            column.collapsed ? "expand_more" : "expand_less"
          }}</mat-icon>
        </div>

        @if(!column.collapsed){
        <div class="column-option">
            <label *ngFor="let item of column.columns">
              <input
                type="checkbox"
                [checked]="item.hide"
                (change)="toggleColumn(item)"
              />{{ item.headerName }}</label
            >
          </div>
        }
      </div>
    </div>
    <!-- <div class="column-menu-footer">
      <button (click)="selectAllColumns(true)" class="btn">Select All</button>
      <button (click)="selectAllColumns(false)" class="btn">
        Deselect All
      </button>
    </div> -->
  </div>

  @if(columnDefs.length){
  <ag-grid-angular
    #agGrid
    class="ag-theme-alpine"
    [rowData]="rowData"
    [columnDefs]="columnDefs"
    [defaultColDef]="defaultColDef"
    [pagination]="true"
    [paginationPageSize]="10"
    [paginationPageSizeSelector]="[10, 25, 50, 100]"
    [rowSelection]="'multiple'"
    [animateRows]="true"
    [sideBar]="sideBar"
    (gridReady)="onGridReady($event)"
    (selectionChanged)="onSelectionChanged()"
    domLayout="autoHeight"
    style="width: 100%"
  >
  </ag-grid-angular>
  }

  <div *ngIf="selectedRows.length > 0" class="selection-info">
    Selected: {{ selectedRows.length }} row(s)
  </div>
</div>
